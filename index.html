<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OneAI - AI Chat Assistant</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #ffffff;
            --secondary-color: #f0f0f0;
            --dark-bg: #272727;
            --darker-bg: #272727;
            --card-bg: #2a2a2a;
            --text-primary: #ffffff;
            --text-secondary: #cccccc;
            --sidebar-width: 300px;
            --header-height: 70px;
            --bubble: #353535;
            --code-bg: #202020;
            --code-color: #d4d4d4;
            --success-color: #48bb78;
            --user-bubble: #353535;
            --ai-bubble: #353535;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--dark-bg);
            color: var(--text-primary);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        html, body {
            overflow: auto;
            height: 100%;
        }

        /* Login Screen */
        .login-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--dark-bg);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            overflow-y: auto;
        }

        .login-container {
            background-color: var(--card-bg);
            border-radius: 16px;
            padding: 40px;
            width: 90%;
            max-width: 500px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            margin: 20px auto;
        }

        .logo {
            font-size: 2.8rem;
            margin-bottom: 20px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo i {
            margin-right: 15px;
        }

        .login-title {
            font-size: 2rem;
            margin-bottom: 30px;
            font-weight: 600;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-size: 1rem;
            color: var(--text-secondary);
        }

        .form-group input {
            width: 100%;
            padding: 14px 16px;
            border-radius: 10px;
            border: 1px solid #2a2a2a;
            background-color: #3d3d3d;
            color: var(--text-primary);
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .login-btn {
            width: 100%;
            padding: 14px;
            background-color: var(--primary-color);
            color: var(--dark-bg);
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-top: 10px;
        }

        .login-btn:hover {
            background-color: var(--secondary-color);
        }

        .google-login {
            background-color: var(--primary-color);
            color: var(--dark-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 15px;
        }

        .divider {
            margin: 25px 0;
            position: relative;
            text-align: center;
            color: var(--text-secondary);
        }

        .divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background-color: #444;
        }

        .divider span {
            background-color: var(--card-bg);
            padding: 0 15px;
        }

        .register-link {
            margin-top: 20px;
            color: var(--text-secondary);
        }

        .register-link a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 600;
        }

        .register-link a:hover {
            text-decoration: underline;
        }

        /* Register Screen */
        .register-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--dark-bg);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            overflow-y: auto;
        }

        /* Main App */
        .app-container {
            display: none;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        /* Header */
        .header {
            background-color: var(--card-bg);
            padding: 0 20px;
            height: var(--header-height);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #444;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            flex-shrink: 0;
            z-index: 100;
        }

        .menu-toggle {
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 1.5rem;
            cursor: pointer;
            display: none;
            padding: 10px;
            border-radius: 8px;
            transition: background-color 0.2s;
        }

        .menu-toggle:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .app-logo {
            display: flex;
            align-items: center;
        }

        .app-logo i {
            font-size: 2rem;
            color: var(--primary-color);
            margin-right: 12px;
        }

        .app-logo h1 {
            font-size: 1.8rem;
            font-weight: 600;
        }

        .user-info {
            display: flex;
            align-items: center;
        }

        .user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background-color: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            overflow: hidden;
        }

        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .user-name {
            font-weight: 500;
            font-size: 1.1rem;
        }

        /* Main Content */
        .main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
            background-color: var(--darker-bg);
        }

        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background-color: var(--card-bg);
            padding: 20px;
            overflow-y: auto;
            border-right: 1px solid #444;
            transition: transform 0.3s ease;
            z-index: 90;
            flex-shrink: 0;
        }

        .new-chat-btn {
            background-color: transparent;
            color: var(--primary-color);
            border: 1px solid #2a2a2a;
            border-radius: 8px;
            padding: 12px 16px;
            width: 100%;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: start;
            margin-bottom: 25px;
            transition: background-color 0.3s;
        }

        .new-chat-btn:hover {
            background-color: #3d3d3d;
        }

        .new-chat-btn i {
            margin-right: 10px;
            font-size: 1rem;
        }

        .history-title {
            font-size: 1rem;
            color: var(--text-secondary);
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .chat-history {
            list-style: none;
        }

        .chat-history li {
            padding: 14px 15px;
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: background-color 0.2s;
            display: flex;
            flex-direction: column;
            font-size: 1.05rem;
        }

        .chat-history li:hover {
            background-color: #3d3d3d;
        }

        .chat-history li.active {
            background-color: #3d3d3d;
            border-left: 4px solid var(--primary-color);
        }

        .chat-title {
            font-weight: 500;
            margin-bottom: 4px;
        }

        .chat-date {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        /* Chat Area */
        .chat-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 15px;
            overflow: hidden;
            background-color: var(--darker-bg);
            position: relative;
        }

        .chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            margin-bottom: 15px;
            display: flex;
            flex-direction: column;
            background-color: var(--darker-bg);
            scroll-behavior: smooth;
        }

        .chat-container::-webkit-scrollbar {
            width: 8px;
        }

        .chat-container::-webkit-scrollbar-track {
            background: transparent;
        }

        .chat-container::-webkit-scrollbar-thumb {
            background: #555;
            border-radius: 4px;
        }

        .chat-container::-webkit-scrollbar-thumb:hover {
            background: #777;
        }

        .message {
            margin-bottom: 20px !important;
            max-width: 85%;
            animation: fadeIn 0.4s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .user-message {
            align-self: flex-end;
            background-color: var(--user-bubble);
            color: #ffffff;
            padding: 10px 20px;
            border-radius: 15px 15px 15px 15px;
            font-size: 1.05rem;
            text-align: left;
            word-break: break-word;
            line-height: 1.5;
            white-space: pre-wrap;
            margin-bottom: 20px !important;
        }

        .ai-message {
            align-self: flex-start;
            background-color: var(--ai-bubble);
            color: var(--text-primary);
            padding: 15px 20px;
            border-radius: 15px 15px 15px 15px;
            font-size: 1.05rem;
            word-break: break-word;
            line-height: 1.5;
            text-align: left;
            white-space: pre-wrap;
            margin-bottom: 20px !important;
        }

        .user-message + .ai-message,
        .ai-message + .user-message {
            margin-top: 20px;
        }

        .test-tag {
            background-color: #dc2626;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-right: 8px;
            font-family: monospace;
            display: inline-block;
            margin-bottom: 8px;
        }

        .arrange-container {
            background-color: #1e293b;
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
        }

        .arrange-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .arrange-instruction {
            color: var(--text-secondary);
            margin-bottom: 15px;
            font-size: 0.95rem;
            line-height: 1.5;
        }

        .arrange-items {
            min-height: 100px;
            padding: 15px;
            background-color: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .arrange-item {
            background-color: rgba(255, 255, 255, 0.1);
            padding: 12px 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: move;
            display: flex;
            align-items: center;
            transition: all 0.2s ease;
        }

        .arrange-item:hover {
            background-color: rgba(255, 255, 255, 0.15);
            transform: translateY(-1px);
        }

        .arrange-item.dragging {
            opacity: 0.5;
        }

        .arrange-item i {
            margin-right: 12px;
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        .arrange-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        .arrange-btn {
            background-color: var(--primary-color);
            color: var(--dark-bg);
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s ease;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .arrange-btn:hover {
            background-color: var(--secondary-color);
            transform: translateY(-1px);
        }

        .arrange-btn:active {
            transform: translateY(0);
        }

        .ai-message strong {
            font-weight: 600;
        }

        .ai-message em {
            font-style: italic;
        }

        .ai-message u {
            text-decoration: underline;
        }

        .ai-message s {
            color: var(--text-secondary);
            text-decoration: line-through;
        }

        .ai-message blockquote {
            border-left: 4px solid var(--primary-color);
            padding-left: 12px;
            margin: 8px 0;
            color: var(--text-secondary);
        }

        .ai-message ul, .ai-message ol {
            margin: 8px 0;
            padding-left: 20px;
        }

        .ai-message li {
            margin-bottom: 4px;
            position: relative;
            padding-left: 6px;
        }

        .ai-message ul li:before {
            content: "â€¢";
            position: absolute;
            left: -10px;
            color: var(--primary-color);
        }

        .ai-message code {
            background-color: #3d3d3d;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
        }

        .ai-message pre {
            background-color: #3d3d3d;
            padding: 10px;
            border-radius: 6px;
            overflow-x: auto;
            margin: 8px 0;
            font-size: 0.9rem;
        }

        .thinking {
            display: none;
            align-self: flex-start;
            background-color: var(--card-bg);
            padding: 12px 16px;
            border-radius: 18px 18px 18px 4px;
            margin-bottom: 20px;
        }

        .thinking-dots {
            display: flex;
        }

        .thinking-dots span {
            height: 8px;
            width: 8px;
            background-color: var(--text-secondary);
            border-radius: 50%;
            margin: 0 2px;
            animation: bounce 1.5s infinite ease-in-out;
        }

        .thinking-dots span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .thinking-dots span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-6px); }
        }

        .input-area {
            display: flex;
            background-color: var(--card-bg);
            border-radius: 16px;
            padding: 12px;
            align-items: flex-end;
            margin-top: auto;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.2);
            position: relative;
            min-height: 70px;
            margin-bottom: 5px;
        }

        .message-input {
            flex: 1;
            background: transparent;
            border: none;
            color: var(--text-primary);
            font-size: 1.1rem;
            padding: 12px 16px;
            padding-right: 50px;
            resize: none;
            max-height: 150px;
            outline: none;
            line-height: 1.5;
            font-family: inherit;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            caret-color: var(--primary-color);
        }

        .message-input:focus {
            outline: none;
        }

        .send-btn {
            background-color: var(--primary-color);
            color: var(--dark-bg);
            border: none;
            border-radius: 10px;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-left: 10px;
            flex-shrink: 0;
            opacity: 0;
            transform: scale(0.8);
            pointer-events: none;
            position: absolute;
            right: 12px;
            bottom: 12px;
        }

        .send-btn.visible {
            opacity: 1;
            transform: scale(1);
            pointer-events: all;
        }

        .send-btn:hover {
            background-color: var(--secondary-color);
            transform: scale(1.05);
        }

        .send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .question-btn {
            background-color: var(--primary-color);
            color: var(--dark-bg);
            border: none;
            border-radius: 6px;
            padding: 8px 16px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.3s;
        }

        .question-btn:hover {
            background-color: var(--secondary-color);
        }

        /* Cards */
        .cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background-color: var(--card-bg);
            border-radius: 16px;
            padding: 20px;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .card-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            background-color: var(--primary-color);
            color: var(--dark-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 1.5rem;
        }

        .card-title {
            font-size: 1.3rem;
            font-weight: 600;
        }

        .card-content {
            color: var(--text-secondary);
            font-size: 1rem;
            line-height: 1.6;
        }

        /* Code Editor */
        .code-editor {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            display: none;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .editor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .editor-title {
            font-size: 1.2rem;
            font-weight: 600;
        }

        .editor-actions {
            display: flex;
            gap: 10px;
        }

        .editor-btn {
            background-color: var(--primary-color);
            color: var(--dark-bg);
            border: none;
            border-radius: 6px;
            padding: 8px 12px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .editor-btn:hover {
            background-color: var(--secondary-color);
        }

        .code-area {
            width: 100%;
            min-height: 200px;
            background-color: #3d3d3d;
            color: var(--text-primary);
            border-radius: 8px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 1rem;
            resize: vertical;
            outline: none;
        }

        /* Code Block */
        .code-block {
            background-color: var(--code-bg);
            border-radius: 8px;
            margin: 10px 0;
            overflow: hidden;
        }

        .code-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background-color: #2d2d2d;
        }

        .code-language {
            font-size: 0.85rem;
            color: var(--text-secondary);
            font-family: 'Courier New', monospace;
        }

        .code-actions {
            display: flex;
            gap: 8px;
        }

        .copy-btn {
            background-color: transparent;
            color: var(--text-secondary);
            border: none;
            border-radius: 4px;
            padding: 4px 8px;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
        }

        .copy-btn:hover {
            background-color: #3d3d3d;
            color: var(--text-primary);
        }

        .copy-btn i {
            margin-right: 4px;
            font-size: 0.7rem;
        }

        .code-content {
            padding: 12px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            color: var(--code-color);
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .code-line {
            display: block;
            white-space: pre;
            margin-bottom: 2px;
        }

        /* Syntax Highlighting Colors */
        .code-keyword { color: #569cd6; }
        .code-string { color: #ce9178; }
        .code-comment { color: #6a9955; }
        .code-function { color: #dcdcaa; }
        .code-number { color: #b5cea8; }
        .code-operator { color: #d4d4d4; }
        .code-punctuation { color: #d4d4d4; }
        .code-html-tag { color: #569cd6; }
        .code-html-attr { color: #9cdcfe; }
        .code-css-prop { color: #9cdcfe; }
        .code-css-value { color: #ce9178; }

        /* Text Maker */
        .text-maker {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            display: none;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .text-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .text-title {
            font-size: 1.2rem;
            font-weight: 600;
        }

        .text-actions {
            display: flex;
            gap: 10px;
        }

        .text-btn {
            background-color: var(--primary-color);
            color: var(--dark-bg);
            border: none;
            border-radius: 6px;
            padding: 8px 12px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .text-btn:hover {
            background-color: var(--secondary-color);
        }

        .text-area {
            width: 100%;
            min-height: 150px;
            background-color: #3d3d3d;
            color: var(--text-primary);
            border-radius: 8px;
            padding: 15px;
            font-family: inherit;
            font-size: 1rem;
            resize: vertical;
            outline: none;
        }

        /* Welcome Image */
        .welcome-image {
            width: 100%;
            max-width: 200px;
            margin: 0 auto 20px;
            display: block;
        }

        .welcome-image img {
            width: 100%;
            height: auto;
            border-radius: 12px;
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 9999;
            animation: slideIn 0.3s ease;
            max-width: 350px;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .notification.success {
            background-color: #48bb78;
        }

        .notification.error {
            background-color: #f56565;
        }

        .notification.info {
            background-color: #4299e1;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .sidebar {
                position: fixed;
                top: var(--header-height);
                left: 0;
                height: calc(100vh - var(--header-height));
                transform: translateX(-100%);
            }

            .sidebar.active {
                transform: translateX(0);
            }

            .menu-toggle {
                display: block;
            }

            .cards-container {
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            }

            .chat-container {
                padding: 12px;
            }
        }

        @media (max-width: 768px) {
            .message {
                max-width: 95%;
            }

            .cards-container {
                grid-template-columns: 1fr;
            }

            .login-container, .register-container {
                padding: 30px 20px;
            }

            .chat-area {
                padding: 10px;
                padding-bottom: 5px;
            }

            .chat-container {
                padding: 10px;
                margin-bottom: 10px;
            }

            .input-area {
                padding: 10px;
                border-radius: 12px;
                min-height: 65px;
                margin-bottom: 5px;
            }

            .message-input {
                padding: 10px 14px;
                padding-right: 45px;
                font-size: 1rem;
            }

            .send-btn {
                width: 45px;
                height: 45px;
                right: 10px;
                bottom: 10px;
            }

            .chat-area {
                padding-top: 8px;
            }
        }

        @media (max-width: 480px) {
            .header {
                padding: 0 10px;
            }

            .app-logo h1 {
                font-size: 1.5rem;
            }

            .chat-area {
                padding: 8px 5px 5px 5px;
            }

            .chat-container {
                padding: 8px 5px;
            }

            .message {
                max-width: 100%;
                margin-bottom: 15px;
            }

            .user-message, .ai-message {
                padding: 12px 16px;
                font-size: 1rem;
            }

            .send-btn {
                width: 42px;
                height: 42px;
            }

            .message-input {
                padding: 10px 12px;
                padding-right: 42px;
                min-height: 44px;
            }

            .input-area {
                min-height: 60px;
                padding: 8px;
            }

            .chat-container {
                -webkit-overflow-scrolling: touch;
            }
        }

        @media (max-height: 600px) {
            .login-container, .register-container {
                margin: 10px auto;
                padding: 20px;
            }
            
            .app-container {
                overflow-y: auto;
            }
            
            .main-content {
                min-height: calc(100vh - var(--header-height));
            }
        }

        @media (hover: none) and (pointer: coarse) {
            .arrange-item:hover {
                background-color: rgba(255, 255, 255, 0.1);
                transform: none;
            }
            
            .card:hover {
                transform: none;
            }
            
            .send-btn:hover {
                transform: none;
            }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div class="login-screen" id="loginScreen">
        <div class="login-container">
            <div class="logo">
                <i class="fas fa-robot"></i>OneAI
            </div>
            <h1 class="login-title">Masuk ke OneAI</h1>
            <form id="loginForm">
                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" id="email" placeholder="nama@contoh.com" required>
                </div>
                <div class="form-group">
                    <label for="password">Kata Sandi</label>
                    <input type="password" id="password" placeholder="Masukkan kata sandi" required>
                </div>
                <button type="submit" class="login-btn">Masuk</button>
            </form>
            <div class="divider"><span>atau</span></div>
            <button class="login-btn google-login" id="googleLoginButton">
                <i class="fab fa-google"></i> Masuk dengan Google
            </button>
            <div class="register-link">
                Belum punya akun? <a href="#" id="registerLink">Daftar di sini</a>
            </div>
        </div>
    </div>

    <!-- Register Screen -->
    <div class="register-screen" id="registerScreen">
        <div class="login-container">
            <div class="logo">
                <i class="fas fa-robot"></i>OneAI
            </div>
            <h1 class="login-title">Daftar ke OneAI</h1>
            <form id="registerForm">
                <div class="form-group">
                    <label for="regName">Nama Lengkap</label>
                    <input type="text" id="regName" placeholder="Masukkan nama lengkap" required>
                </div>
                <div class="form-group">
                    <label for="regEmail">Email</label>
                    <input type="email" id="regEmail" placeholder="nama@contoh.com" required>
                </div>
                <div class="form-group">
                    <label for="regPassword">Kata Sandi</label>
                    <input type="password" id="regPassword" placeholder="Buat kata sandi" required>
                </div>
                <div class="form-group">
                    <label for="regConfirmPassword">Konfirmasi Kata Sandi</label>
                    <input type="password" id="regConfirmPassword" placeholder="Konfirmasi kata sandi" required>
                </div>
                <button type="submit" class="login-btn">Daftar</button>
            </form>
            <div class="register-link">
                Sudah punya akun? <a href="#" id="loginLink">Masuk di sini</a>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div class="app-container" id="appContainer">
        <header class="header">
            <button class="menu-toggle" id="menuToggle">
                <i class="fas fa-bars"></i>
            </button>
            <div class="app-logo">
                <i class="fas fa-robot"></i>
                <h1>OneAI</h1>
            </div>
            <div class="user-info">
                <div id="userProfile" style="display: none; align-items: center;">
                    <div class="user-avatar">
                        <img src="" alt="Profile" id="userAvatar">
                    </div>
                    <div class="user-name" id="userNameDisplay"></div>
                </div>
            </div>
        </header>
        
        <div class="main-content">
            <aside class="sidebar" id="sidebar">
                <button class="new-chat-btn" id="newChatBtn">
                    <i class="fas fa-pencil-alt"></i> <span>Percakapan Baru</span>
                </button>
                <h3 class="history-title">Riwayat Percakapan</h3>
                <ul class="chat-history" id="chatHistory"></ul>
            </aside>
            
            <section class="chat-area">
                <div class="welcome-image" id="welcomeImage" style="display: none;">
                    <img src="https://chat.anomaly.my.id/astronaut-3.webp" alt="Welcome to OneAI">
                </div>
                
                <div class="cards-container" id="cardsContainer">
                    <div class="card" data-prompt="Buat soal tes matematika tentang aljabar dengan 5 pilihan ganda">
                        <div class="card-header">
                            <div class="card-icon">
                                <i class="fas fa-calculator"></i>
                            </div>
                            <div class="card-title">Buat Soal Matematika</div>
                        </div>
                        <div class="card-content">
                            Minta OneAI untuk membuat soal tes matematika dengan pilihan ganda lengkap dengan jawaban.
                        </div>
                    </div>
                    <div class="card" data-prompt="Buat soal tes bahasa Inggris tentang grammar tingkat menengah">
                        <div class="card-header">
                            <div class="card-icon">
                                <i class="fas fa-language"></i>
                            </div>
                            <div class="card-title">Buat Soal Bahasa Inggris</div>
                        </div>
                        <div class="card-content">
                            Dapatkan soal bahasa Inggris dengan berbagai level kesulitan dan topik grammar.
                        </div>
                    </div>
                    <div class="card" data-prompt="Bantu saya menulis kode JavaScript untuk validasi form">
                        <div class="card-header">
                            <div class="card-icon">
                                <i class="fas fa-code"></i>
                            </div>
                            <div class="card-title">Buat Kode Script</div>
                        </div>
                        <div class="card-content">
                            Minta OneAI untuk membuat kode script dalam berbagai bahasa pemrograman.
                        </div>
                    </div>
                    <div class="card" data-prompt="Tulis puisi tentang teknologi dan masa depan">
                        <div class="card-header">
                            <div class="card-icon">
                                <i class="fas fa-pen-fancy"></i>
                            </div>
                            <div class="card-title">Tulis Konten Kreatif</div>
                        </div>
                        <div class="card-content">
                            OneAI dapat membantu Anda menulis artikel, puisi, atau konten kreatif lainnya.
                        </div>
                    </div>
                </div>
                
                <div class="code-editor" id="codeEditor">
                    <div class="editor-header">
                        <div class="editor-title">Editor Kode</div>
                        <div class="editor-actions">
                            <button class="editor-btn" id="analyzeCodeBtn">Analisis Kode</button>
                            <button class="editor-btn" id="clearCodeBtn">Hapus</button>
                        </div>
                    </div>
                    <textarea class="code-area" id="codeArea" placeholder="Tempel kode Anda di sini..."></textarea>
                </div>
                
                <div class="text-maker" id="textMaker">
                    <div class="text-header">
                        <div class="text-title">Pembuat Teks Kreatif</div>
                        <div class="text-actions">
                            <button class="text-btn" id="generateTextBtn">Buat Teks</button>
                            <button class="text-btn" id="clearTextBtn">Hapus</button>
                        </div>
                    </div>
                    <textarea class="text-area" id="textArea" placeholder="Masukkan instruksi untuk teks yang ingin dibuat..."></textarea>
                </div>
                
                <div class="chat-container" id="chatContainer">
                    <div class="message ai-message">
                        Halo! Aku adalah OneAI, versi OneAI 1.0 â€” asisten cerdas kamu yang siap bantu menjelaskan apa saja dengan cara yang mudah dimengerti. Kamu mau ngobrol soal teknologi, coding, AI, atau topik apa hari ini? ðŸ˜Š
                    </div>
                </div>
                
                <div class="thinking" id="thinkingIndicator">
                    <div class="thinking-dots">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                </div>
                
                <div class="input-area">
                    <textarea class="message-input" id="messageInput" placeholder="Ketik pesan Anda di sini..." rows="1"></textarea>
                    <button class="send-btn" id="sendBtn">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </section>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notificationContainer"></div>

    <script>
        // Konfigurasi API dan Google
        const SERVER_URL = "https://oneaimyai.vercel.app/api/gemini";
        const GOOGLE_CLIENT_ID = "530815783383-tmop98prhc7skof6peqhrm470gcpco5e.apps.googleusercontent.com";
        
        // Variabel global
        const loginScreen = document.getElementById('loginScreen');
        const registerScreen = document.getElementById('registerScreen');
        const appContainer = document.getElementById('appContainer');
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');
        const googleLoginButton = document.getElementById('googleLoginButton');
        const registerLink = document.getElementById('registerLink');
        const loginLink = document.getElementById('loginLink');
        const userProfile = document.getElementById('userProfile');
        const userAvatar = document.getElementById('userAvatar');
        const userNameDisplay = document.getElementById('userNameDisplay');
        const menuToggle = document.getElementById('menuToggle');
        const sidebar = document.getElementById('sidebar');
        const newChatBtn = document.getElementById('newChatBtn');
        const chatHistory = document.getElementById('chatHistory');
        const chatContainer = document.getElementById('chatContainer');
        const cardsContainer = document.getElementById('cardsContainer');
        const codeEditor = document.getElementById('codeEditor');
        const codeArea = document.getElementById('codeArea');
        const analyzeCodeBtn = document.getElementById('analyzeCodeBtn');
        const clearCodeBtn = document.getElementById('clearCodeBtn');
        const textMaker = document.getElementById('textMaker');
        const textArea = document.getElementById('textArea');
        const generateTextBtn = document.getElementById('generateTextBtn');
        const clearTextBtn = document.getElementById('clearTextBtn');
        const messageInput = document.getElementById('messageInput');
        const sendBtn = document.getElementById('sendBtn');
        const thinkingIndicator = document.getElementById('thinkingIndicator');
        const cards = document.querySelectorAll('.card');
        const welcomeImage = document.getElementById('welcomeImage');

        let currentChatId = null;
        let chats = JSON.parse(localStorage.getItem('oneai_chats')) || {};
        let currentUser = JSON.parse(localStorage.getItem('oneai_user')) || null;
        let isSendingMessage = false;

        // Fungsi untuk menampilkan notifikasi
        function showNotification(message, type = 'info') {
            const container = document.getElementById('notificationContainer');
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            notification.style.display = 'block';
            
            container.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideIn 0.3s ease reverse';
                setTimeout(() => {
                    container.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // Fungsi untuk login Google
        function handleGoogleLogin() {
            showNotification('Redirecting to Google login...', 'info');
            
            const redirectUri = encodeURIComponent('https://bloxaryn.github.io/OneAI/');
            const scope = encodeURIComponent('profile email');
            const authUrl = `https://accounts.google.com/o/oauth2/v2/auth?client_id=${GOOGLE_CLIENT_ID}&redirect_uri=${redirectUri}&response_type=token&scope=${scope}`;
            
            window.open(authUrl, 'googleLogin', 'width=500,height=600');
            
            checkForToken();
        }

        // Fungsi untuk memeriksa token di URL
        function checkForToken() {
            const hash = window.location.hash;
            if (hash && hash.includes('access_token')) {
                const token = hash.split('access_token=')[1].split('&')[0];
                handleLoginSuccess(token);
                window.location.hash = '';
            }
        }

        // Fungsi untuk menangani login sukses
        async function handleLoginSuccess(token) {
            try {
                const response = await fetch('https://www.googleapis.com/oauth2/v1/userinfo?alt=json', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Failed to fetch user info');
                }
                
                const userInfo = await response.json();
                
                localStorage.setItem('userLoggedIn', 'true');
                localStorage.setItem('userName', userInfo.name);
                localStorage.setItem('userEmail', userInfo.email);
                localStorage.setItem('userPicture', userInfo.picture);

                updateUserProfile(userInfo);
                showNotification(`Welcome, ${userInfo.name}!`, 'success');

                currentUser = {
                    name: userInfo.name,
                    email: userInfo.email,
                    avatar: userInfo.picture
                };
                localStorage.setItem('oneai_user', JSON.stringify(currentUser));
                
                showApp();
                
            } catch (error) {
                console.error('Gagal login:', error);
                showNotification('Login gagal. Coba lagi.', 'error');
            }
        }

        // Fungsi untuk memeriksa status login
        function checkLoginStatus() {
            const isLoggedIn = localStorage.getItem('userLoggedIn') === 'true';
            if (isLoggedIn) {
                const userData = {
                    name: localStorage.getItem('userName'),
                    email: localStorage.getItem('userEmail'),
                    picture: localStorage.getItem('userPicture')
                };
                updateUserProfile(userData);
                return true;
            }
            return false;
        }

        // Fungsi untuk memperbarui profil pengguna
        function updateUserProfile(userData) {
            googleLoginButton.style.display = 'none';
            userProfile.style.display = 'flex';
            userNameDisplay.textContent = userData.name;
            userAvatar.src = userData.picture;
        }

        // Inisialisasi aplikasi
        function initApp() {
            if (checkLoginStatus()) {
                currentUser = {
                    name: localStorage.getItem('userName'),
                    email: localStorage.getItem('userEmail'),
                    avatar: localStorage.getItem('userPicture') || "https://chat.anomaly.my.id/astronaut-3.webp"
                };
                showApp();
            } else {
                showLogin();
            }
            
            loadChatHistory();
            setupEventListeners();
            
            if (messageInput) {
                messageInput.style.height = 'auto';
                messageInput.style.height = messageInput.scrollHeight + 'px';
            }
        }

        // Setup event listeners
        function setupEventListeners() {
            if (!messageInput) {
                console.error('messageInput element not found');
                return;
            }

            messageInput.addEventListener('input', function() {
                try {
                    this.style.height = 'auto';
                    this.style.height = (this.scrollHeight) + 'px';
                    
                    const hasText = this.value.trim().length > 0;
                    if (hasText) {
                        sendBtn.classList.add('visible');
                    } else {
                        sendBtn.classList.remove('visible');
                    }
                    
                    setTimeout(() => {
                        chatContainer.scrollTop = chatContainer.scrollHeight;
                    }, 50);
                } catch (error) {
                    console.log('Input event error:', error);
                }
            });

            messageInput.addEventListener('keydown', function(e) {
                try {
                    if (e.key === 'Enter') {
                        if (e.ctrlKey || e.metaKey) {
                            e.preventDefault();
                            if (!isSendingMessage && this.value.trim().length > 0) {
                                sendMessage();
                            }
                        } else if (!e.shiftKey) {
                            e.preventDefault();
                            const cursorPos = this.selectionStart;
                            const textBefore = this.value.substring(0, cursorPos);
                            const textAfter = this.value.substring(cursorPos);
                            
                            this.value = textBefore + '\n' + textAfter;
                            this.selectionStart = cursorPos + 1;
                            this.selectionEnd = cursorPos + 1;
                            
                            this.style.height = 'auto';
                            this.style.height = (this.scrollHeight) + 'px';
                        }
                    }
                } catch (error) {
                    console.log('Keydown event error:', error);
                }
            });

            loginForm.addEventListener('submit', function(e) {
                e.preventDefault();
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;
                loginUser(email, password);
            });

            registerForm.addEventListener('submit', function(e) {
                e.preventDefault();
                const name = document.getElementById('regName').value;
                const email = document.getElementById('regEmail').value;
                const password = document.getElementById('regPassword').value;
                const confirmPassword = document.getElementById('regConfirmPassword').value;
                
                if (password !== confirmPassword) {
                    showNotification('Kata sandi tidak cocok!', 'error');
                    return;
                }
                registerUser(name, email, password);
            });

            googleLoginButton.addEventListener('click', function(e) {
                e.preventDefault();
                handleGoogleLogin();
            });

            registerLink.addEventListener('click', function(e) {
                e.preventDefault();
                showRegister();
            });

            loginLink.addEventListener('click', function(e) {
                e.preventDefault();
                showLogin();
            });

            sendBtn.addEventListener('click', function() {
                if (!isSendingMessage && messageInput.value.trim().length > 0) {
                    sendMessage();
                }
            });

            newChatBtn.addEventListener('click', createNewChat);
            menuToggle.addEventListener('click', function() {
                sidebar.classList.toggle('active');
            });

            cards.forEach(card => {
                card.addEventListener('click', function() {
                    const prompt = this.getAttribute('data-prompt');
                    if (this.querySelector('.card-title').textContent.includes('Kode')) {
                        showCodeEditor();
                    } else if (this.querySelector('.card-title').textContent.includes('Tulis')) {
                        showTextMaker();
                    } else {
                        messageInput.value = prompt;
                        messageInput.style.height = 'auto';
                        messageInput.style.height = (messageInput.scrollHeight) + 'px';
                        sendBtn.classList.add('visible');
                        sendMessage();
                    }
                });
            });

            analyzeCodeBtn.addEventListener('click', function() {
                const code = codeArea.value.trim();
                if (!code) {
                    showNotification('Silakan masukkan kode untuk dianalisis.', 'error');
                    return;
                }
                codeEditor.style.display = 'none';
                cardsContainer.style.display = 'none';
                textMaker.style.display = 'none';
                welcomeImage.style.display = 'none';
                messageInput.value = `Analisis kode berikut dan berikan saran perbaikan:\n\n\`\`\`javascript\n${code}\n\`\`\``;
                messageInput.style.height = 'auto';
                messageInput.style.height = (messageInput.scrollHeight) + 'px';
                sendBtn.classList.add('visible');
                sendMessage();
            });

            clearCodeBtn.addEventListener('click', function() {
                codeArea.value = '';
            });

            generateTextBtn.addEventListener('click', function() {
                const textPrompt = textArea.value.trim();
                if (!textPrompt) {
                    showNotification('Silakan masukkan instruksi untuk membuat teks.', 'error');
                    return;
                }
                textMaker.style.display = 'none';
                cardsContainer.style.display = 'none';
                codeEditor.style.display = 'none';
                welcomeImage.style.display = 'none';
                messageInput.value = textPrompt;
                messageInput.style.height = 'auto';
                messageInput.style.height = (messageInput.scrollHeight) + 'px';
                sendBtn.classList.add('visible');
                sendMessage();
            });

            clearTextBtn.addEventListener('click', function() {
                textArea.value = '';
            });

            document.addEventListener('click', function(event) {
                if (window.innerWidth <= 1024) {
                    const isClickInsideSidebar = sidebar.contains(event.target);
                    const isClickOnMenuToggle = menuToggle.contains(event.target);
                    
                    if (!isClickInsideSidebar && !isClickOnMenuToggle && sidebar.classList.contains('active')) {
                        sidebar.classList.remove('active');
                    }
                }
            });

            window.addEventListener('resize', function() {
                if (window.innerWidth > 1024 && sidebar.classList.contains('active')) {
                    sidebar.classList.remove('active');
                }
                
                try {
                    messageInput.style.height = 'auto';
                    messageInput.style.height = (messageInput.scrollHeight) + 'px';
                } catch (error) {
                    console.log('Resize error:', error);
                }
            });

            const observer = new MutationObserver(function() {
                setTimeout(() => {
                    chatContainer.scrollTop = chatContainer.scrollHeight;
                }, 100);
            });
            
            if (chatContainer) {
                observer.observe(chatContainer, { childList: true, subtree: true });
            }
        }

        function showLogin() {
            loginScreen.style.display = 'flex';
            registerScreen.style.display = 'none';
            appContainer.style.display = 'none';
        }

        function showRegister() {
            loginScreen.style.display = 'none';
            registerScreen.style.display = 'flex';
            appContainer.style.display = 'none';
        }

        function showApp() {
            loginScreen.style.display = 'none';
            registerScreen.style.display = 'none';
            appContainer.style.display = 'flex';
            
            if (welcomeImage) {
                welcomeImage.style.display = 'block';
            }
            
            if (Object.keys(chats).length === 0) {
                createNewChat();
            } else {
                const chatIds = Object.keys(chats);
                currentChatId = chatIds[chatIds.length - 1];
                loadChat(currentChatId);
            }
            
            sendBtn.classList.remove('visible');
            
            setTimeout(() => {
                if (messageInput && messageInput.parentElement) {
                    messageInput.parentElement.style.marginTop = 'auto';
                    messageInput.parentElement.style.marginBottom = '8px';
                }
                if (messageInput) {
                    messageInput.focus();
                }
            }, 100);
        }

        function loginUser(email, password) {
            const loginBtn = loginForm.querySelector('.login-btn');
            const originalText = loginBtn.textContent;
            loginBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Memproses...';
            loginBtn.disabled = true;
            
            setTimeout(() => {
                currentUser = {
                    name: email.split('@')[0],
                    email: email,
                    avatar: "https://chat.anomaly.my.id/astronaut-3.webp"
                };
                localStorage.setItem('oneai_user', JSON.stringify(currentUser));
                localStorage.setItem('userLoggedIn', 'true');
                localStorage.setItem('userName', currentUser.name);
                localStorage.setItem('userEmail', currentUser.email);
                
                showApp();
                loginBtn.textContent = originalText;
                loginBtn.disabled = false;
                showNotification('Login berhasil!', 'success');
            }, 1500);
        }

        function registerUser(name, email, password) {
            const registerBtn = registerForm.querySelector('.login-btn');
            const originalText = registerBtn.textContent;
            registerBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Memproses...';
            registerBtn.disabled = true;
            
            setTimeout(() => {
                currentUser = {
                    name: name,
                    email: email,
                    avatar: "https://chat.anomaly.my.id/astronaut-3.webp"
                };
                localStorage.setItem('oneai_user', JSON.stringify(currentUser));
                localStorage.setItem('userLoggedIn', 'true');
                localStorage.setItem('userName', currentUser.name);
                localStorage.setItem('userEmail', currentUser.email);
                
                showApp();
                registerBtn.textContent = originalText;
                registerBtn.disabled = false;
                showNotification('Pendaftaran berhasil!', 'success');
            }, 1500);
        }

        function createNewChat() {
            const chatId = 'chat_' + Date.now();
            currentChatId = chatId;
            
            chats[chatId] = {
                id: chatId,
                title: 'Percakapan Baru',
                messages: [
                    {
                        role: 'ai',
                        content: 'Halo! Aku adalah OneAI, versi OneAI 1.0 â€” asisten cerdas kamu yang siap bantu menjelaskan apa saja dengan cara yang mudah dimengerti. Kamu mau ngobrol soal teknologi, coding, AI, atau topik apa hari ini? ðŸ˜Š',
                        timestamp: new Date().toISOString()
                    }
                ],
                createdAt: new Date().toISOString()
            };
            
            localStorage.setItem('oneai_chats', JSON.stringify(chats));
            loadChatHistory();
            loadChat(chatId);
            cardsContainer.style.display = 'grid';
            codeEditor.style.display = 'none';
            textMaker.style.display = 'none';
            
            if (welcomeImage) {
                welcomeImage.style.display = 'block';
            }
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffTime = Math.abs(now - date);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffDays === 1) {
                return 'Hari ini';
            } else if (diffDays === 2) {
                return 'Kemarin';
            } else if (diffDays <= 7) {
                return `${diffDays - 1} hari lalu`;
            } else {
                return date.toLocaleDateString('id-ID', {
                    day: 'numeric',
                    month: 'short'
                });
            }
        }

        function loadChatHistory() {
            chatHistory.innerHTML = '';
            const sortedChats = Object.values(chats).sort((a, b) => 
                new Date(b.createdAt) - new Date(a.createdAt)
            );
            
            const groupedChats = {};
            sortedChats.forEach(chat => {
                const date = formatDate(chat.createdAt);
                if (!groupedChats[date]) {
                    groupedChats[date] = [];
                }
                groupedChats[date].push(chat);
            });
            
            for (const [date, dateChats] of Object.entries(groupedChats)) {
                dateChats.forEach(chat => {
                    const li = document.createElement('li');
                    li.className = currentChatId === chat.id ? 'active' : '';
                    li.innerHTML = `
                        <div class="chat-title">${chat.title}</div>
                        <div class="chat-date">${date}</div>
                    `;
                    li.addEventListener('click', () => {
                        currentChatId = chat.id;
                        loadChat(chat.id);
                        loadChatHistory();
                        if (window.innerWidth <= 1024) {
                            sidebar.classList.remove('active');
                        }
                    });
                    chatHistory.appendChild(li);
                });
            }
        }

        function loadChat(chatId) {
            const chat = chats[chatId];
            if (!chat) return;
            
            chatContainer.innerHTML = '';
            chat.messages.forEach(message => {
                addMessageToChat(message.content, message.role, false);
            });
            chatContainer.scrollTop = chatContainer.scrollHeight;
            
            if (chat.messages.length === 1) {
                cardsContainer.style.display = 'grid';
                if (welcomeImage) {
                    welcomeImage.style.display = 'block';
                }
            } else {
                cardsContainer.style.display = 'none';
                if (welcomeImage) {
                    welcomeImage.style.display = 'none';
                }
            }
            codeEditor.style.display = 'none';
            textMaker.style.display = 'none';
        }

        async function sendMessage() {
            const message = messageInput.value.trim();
            if (!message || isSendingMessage) return;
            
            isSendingMessage = true;
            sendBtn.disabled = true;
            sendBtn.classList.remove('visible');
            
            addMessageToChat(message, 'user');
            messageInput.value = '';
            
            try {
                messageInput.style.height = 'auto';
                messageInput.style.height = 'auto';
            } catch (error) {
                console.log('Send message error:', error);
            }
            
            cardsContainer.style.display = 'none';
            codeEditor.style.display = 'none';
            textMaker.style.display = 'none';
            if (welcomeImage) {
                welcomeImage.style.display = 'none';
            }
            
            thinkingIndicator.style.display = 'block';
            
            setTimeout(async () => {
                thinkingIndicator.style.display = 'none';
                
                if (chats[currentChatId].messages.length === 1) {
                    const title = generateChatTitle(message);
                    chats[currentChatId].title = title;
                    loadChatHistory();
                }
                
                await processUserMessage(message);
                isSendingMessage = false;
                sendBtn.disabled = false;
                
                setTimeout(() => {
                    chatContainer.scrollTop = chatContainer.scrollHeight;
                }, 100);
            }, 800);
        }

        async function processUserMessage(message) {
            const scriptMatch = message.match(/^:script:{([^}]+)}:/i);
            if (scriptMatch) {
                const filename = scriptMatch[1];
                const scriptContent = getScriptContent(filename);
                if (scriptContent) {
                    chats[currentChatId].messages.push({
                        role: 'user',
                        content: message,
                        timestamp: new Date().toISOString()
                    });
                    
                    const codeBlock = createCodeBlock('javascript', scriptContent);
                    const messageDiv = document.createElement('div');
                    messageDiv.className = 'message ai-message';
                    const contentDiv = document.createElement('div');
                    contentDiv.innerHTML = `<span class="test-tag">test</span> Berikut adalah kode untuk ${filename}:`;
                    messageDiv.appendChild(contentDiv);
                    messageDiv.appendChild(codeBlock);
                    chatContainer.appendChild(messageDiv);
                    
                    chats[currentChatId].messages.push({
                        role: 'ai',
                        content: `Berikut adalah kode untuk ${filename}: ${scriptContent}`,
                        timestamp: new Date().toISOString()
                    });
                    
                    localStorage.setItem('oneai_chats', JSON.stringify(chats));
                    chatContainer.scrollTop = chatContainer.scrollHeight;
                    return;
                }
            }
            
            const arrangeMatch = message.toLowerCase().includes('susun') || 
                               message.toLowerCase().includes('arrange') ||
                               message.toLowerCase().includes('urutkan');
            
            chats[currentChatId].messages.push({
                role: 'user',
                content: message,
                timestamp: new Date().toISOString()
            });
            
            if (arrangeMatch) {
                createArrangeInterface(message);
                return;
            }
            
try {
    const conversationContext = prepareConversationContext(message);
    
    const response = await fetch(SERVER_URL, {  // âœ… GUNAKAN SERVER_URL, BUKAN API KEY LANGSUNG!
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            message: message,  // âœ… KIRIM PESAN, BUKAN `contents`
            conversationHistory: chats[currentChatId].messages.slice(-5)  // âœ… KIRIM HISTORY
        })
    });

    if (!response.ok) {
        const errorText = await response.text();
        console.error('Server Error:', errorText);
        throw new Error(`Server Error: ${response.status}`);
    }

    const data = await response.json();
    
    // âœ… RESPONSE DARI SERVER MU
    if (data.success && data.response) {
        const aiResponse = data.response;
        const cleanResponse = cleanTextResponse(aiResponse);
        
        chats[currentChatId].messages.push({
            role: 'ai',
            content: cleanResponse,
            timestamp: new Date().toISOString()
        });
        
        localStorage.setItem('oneai_chats', JSON.stringify(chats));
        
        await showFastTypedResponse(cleanResponse, message);
        
    } else {
        throw new Error(data.error || 'Invalid response from server');
    }
    
} catch (error) {
    console.error('Error calling server:', error);
    
    const fallbackResponse = getAppropriateResponse(message);
    
    chats[currentChatId].messages.push({
        role: 'ai',
        content: fallbackResponse,
        timestamp: new Date().toISOString()
    });
    
    localStorage.setItem('oneai_chats', JSON.stringify(chats));
    
    await showFastTypedResponse(fallbackResponse, message);
}
}

        // Fungsi animasi typing cepat (20 karakter per detik = 50ms per karakter)
        async function showFastTypedResponse(response, originalMessage) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message ai-message';
            chatContainer.appendChild(messageDiv);
            
            const hasTestTag = originalMessage.toLowerCase().includes('test');
            
            if (hasTestTag) {
                const testTag = document.createElement('span');
                testTag.className = 'test-tag';
                testTag.textContent = 'test';
                messageDiv.appendChild(testTag);
                messageDiv.appendChild(document.createTextNode(' '));
            }
            
            const delayPerCharacter = 50; // 20 karakter per detik
            
            const characters = response.split('');
            
            let currentIndex = 0;
            let currentContent = '';
            
            function addNextCharacter() {
                if (currentIndex >= characters.length) {
                    const finalContent = formatResponse(response);
                    messageDiv.innerHTML = (hasTestTag ? '<span class="test-tag">test</span> ' : '') + finalContent;
                    
                    if (currentChatId) {
                        const cleanResponse = cleanTextResponse(response);
                        chats[currentChatId].messages.push({
                            role: 'ai',
                            content: cleanResponse,
                            timestamp: new Date().toISOString()
                        });
                        localStorage.setItem('oneai_chats', JSON.stringify(chats));
                    }
                    
                    setTimeout(() => {
                        chatContainer.scrollTop = chatContainer.scrollHeight;
                    }, 50);
                    
                    return;
                }
                
                currentContent += characters[currentIndex];
                currentIndex++;
                
                const formattedContent = formatPartialContent(currentContent);
                messageDiv.innerHTML = (hasTestTag ? '<span class="test-tag">test</span> ' : '') + formattedContent;
                
                chatContainer.scrollTop = chatContainer.scrollHeight;
                
                setTimeout(addNextCharacter, delayPerCharacter);
            }
            
            addNextCharacter();
        }

        function cleanTextResponse(text) {
            let cleaned = text.replace(/\n{3,}/g, '\n\n');
            cleaned = cleaned.trim();
            cleaned = cleaned.replace(/^\s*[â€¢\-*]\s+/gm, 'â€¢ ');
            cleaned = cleaned.replace(/^\s*\d+\.\s+/gm, (match) => match.trim() + ' ');
            return cleaned;
        }

        function createArrangeInterface(prompt) {
            const items = [];
            
            if (prompt.toLowerCase().includes('matematika')) {
                items.push(
                    { id: 1, text: "Selesaikan persamaan kuadrat" },
                    { id: 2, text: "Faktorkan persamaan" },
                    { id: 3, text: "Hitung diskriminan" },
                    { id: 4, text: "Tentukan akar-akar" },
                    { id: 5, text: "Verifikasi solusi" }
                );
            } else if (prompt.toLowerCase().includes('bahasa')) {
                items.push(
                    { id: 1, text: "Baca teks dengan seksama" },
                    { id: 2, text: "Identifikasi kata kunci" },
                    { id: 3, text: "Analisis struktur kalimat" },
                    { id: 4, text: "Temukan ide pokok" },
                    { id: 5, text: "Buat kesimpulan" }
                );
            } else {
                items.push(
                    { id: 1, text: "Langkah pertama" },
                    { id: 2, text: "Langkah kedua" },
                    { id: 3, text: "Langkah ketiga" },
                    { id: 4, text: "Langkah keempat" },
                    { id: 5, text: "Langkah kelima" }
                );
            }
            
            const arrangeContainer = document.createElement('div');
            arrangeContainer.className = 'arrange-container';
            
            arrangeContainer.innerHTML = `
                <div class="arrange-title"><i class="fas fa-sort"></i> Susun Jawaban</div>
                <div class="arrange-instruction">Susunlah langkah-langkah berikut sesuai urutan yang benar dengan cara drag & drop:</div>
                <div class="arrange-items" id="arrangeItems"></div>
                <div class="arrange-actions">
                    <button class="arrange-btn" id="submitArrangeBtn">
                        <i class="fas fa-paper-plane"></i> Kirim Jawaban
                    </button>
                    <button class="arrange-btn" id="resetArrangeBtn">
                        <i class="fas fa-redo"></i> Reset Urutan
                    </button>
                </div>
            `;
            
            const itemsContainer = arrangeContainer.querySelector('#arrangeItems');
            
            const shuffledItems = [...items].sort(() => Math.random() - 0.5);
            
            shuffledItems.forEach(item => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'arrange-item';
                itemDiv.draggable = true;
                itemDiv.dataset.id = item.id;
                itemDiv.innerHTML = `<i class="fas fa-grip-vertical"></i> ${item.text}`;
                
                itemDiv.addEventListener('dragstart', (e) => {
                    e.dataTransfer.setData('text/plain', item.id);
                    itemDiv.classList.add('dragging');
                });
                
                itemDiv.addEventListener('dragend', () => {
                    itemDiv.classList.remove('dragging');
                });
                
                itemsContainer.appendChild(itemDiv);
            });
            
            itemsContainer.addEventListener('dragover', (e) => {
                e.preventDefault();
                const dragging = document.querySelector('.arrange-item.dragging');
                if (!dragging) return;
                
                const afterElement = getDragAfterElement(itemsContainer, e.clientY);
                
                if (afterElement == null) {
                    itemsContainer.appendChild(dragging);
                } else {
                    itemsContainer.insertBefore(dragging, afterElement);
                }
            });
            
            arrangeContainer.querySelector('#submitArrangeBtn').addEventListener('click', () => {
                const currentOrder = Array.from(itemsContainer.children).map(child => 
                    parseInt(child.dataset.id)
                );
                
                const arrangedText = currentOrder.map((id, index) => {
                    const item = items.find(i => i.id === id);
                    return `${index + 1}. ${item.text}`;
                }).join('\n');
                
                arrangeContainer.remove();
                
                setTimeout(() => {
                    const arrangedMessage = `Saya telah menyusun jawaban:\n${arrangedText}`;
                    addMessageToChat(arrangedMessage, 'user');
                    
                    setTimeout(() => {
                        processUserMessage(arrangedMessage);
                    }, 500);
                }, 300);
            });
            
            arrangeContainer.querySelector('#resetArrangeBtn').addEventListener('click', () => {
                const shuffled = [...items].sort(() => Math.random() - 0.5);
                itemsContainer.innerHTML = '';
                
                shuffled.forEach(item => {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'arrange-item';
                    itemDiv.draggable = true;
                    itemDiv.dataset.id = item.id;
                    itemDiv.innerHTML = `<i class="fas fa-grip-vertical"></i> ${item.text}`;
                    
                    itemDiv.addEventListener('dragstart', (e) => {
                        e.dataTransfer.setData('text/plain', item.id);
                        itemDiv.classList.add('dragging');
                    });
                    
                    itemDiv.addEventListener('dragend', () => {
                        itemDiv.classList.remove('dragging');
                    });
                    
                    itemsContainer.appendChild(itemDiv);
                });
            });
            
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message ai-message';
            messageDiv.appendChild(arrangeContainer);
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('.arrange-item:not(.dragging)')];
            
            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                
                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }

        function formatPartialContent(content) {
            let formatted = content
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/\n/g, '<br>')
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/__(.*?)__/g, '<u>$1</u>')
                .replace(/~~(.*?)~~/g, '<s>$1</s>')
                .replace(/`(.*?)`/g, '<code>$1</code>')
                .replace(/^> (.*$)/gm, '<blockquote>$1</blockquote>');
            
            return formatted;
        }

        function formatResponse(text) {
            if (typeof text !== 'string') return text;
            
            let formatted = text
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/__(.*?)__/g, '<u>$1</u>')
                .replace(/~~(.*?)~~/g, '<s>$1</s>')
                .replace(/`(.*?)`/g, '<code>$1</code>')
                .replace(/^> (.*$)/gm, '<blockquote>$1</blockquote>')
                .replace(/\n/g, '<br>')
                .replace(/^\s*â€¢\s+/gm, '<span style="display: inline-block; width: 10px;">â€¢</span> ')
                .replace(/^\s*\d+\.\s+/gm, (match) => match.trim() + ' ');
            
            formatted = formatted.replace(/<br>\s*<br>/g, '<br><br>');
            
            return formatted;
        }

        function getScriptContent(filename) {
            const scripts = {
                'login.js': `// Login script
function loginUser(email, password) {
    if (!email || !password) {
        return { success: false, message: 'Email dan password harus diisi' };
    }
    
    fetch('/api/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email, password })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            localStorage.setItem('token', data.token);
            window.location.href = '/dashboard';
        } else {
            showError(data.message);
        }
    })
    .catch(error => {
        console.error('Login error:', error);
        showError('Terjadi kesalahan saat login');
    });
}`,
                
                'form-validation.js': `// Form validation
function validateForm(formId) {
    const form = document.getElementById(formId);
    let isValid = true;
    const errors = [];
    
    form.querySelectorAll('[required]').forEach(field => {
        if (!field.value.trim()) {
            isValid = false;
            errors.push(\`\${field.name} harus diisi\`);
            field.classList.add('error');
        } else {
            field.classList.remove('error');
        }
    });
    
    const emailField = form.querySelector('input[type="email"]');
    if (emailField && emailField.value) {
        const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;
        if (!emailRegex.test(emailField.value)) {
            isValid = false;
            errors.push('Format email tidak valid');
            emailField.classList.add('error');
        }
    }
    
    return { isValid, errors };
}`,
                
                'chat.js': `// Chat functionality
class Chat {
    constructor() {
        this.messages = [];
        this.connected = false;
    }
    
    connect() {
        this.socket = new WebSocket('wss://chat.example.com');
        this.socket.onopen = () => {
            this.connected = true;
            console.log('Connected to chat server');
        };
        
        this.socket.onmessage = (event) => {
            const message = JSON.parse(event.data);
            this.addMessage(message);
        };
    }
    
    sendMessage(text) {
        if (!this.connected) {
            console.error('Not connected to server');
            return;
        }
        
        const message = {
            id: Date.now(),
            text: text,
            timestamp: new Date().toISOString(),
            sender: 'user'
        };
        
        this.socket.send(JSON.stringify(message));
        this.addMessage(message);
    }
    
    addMessage(message) {
        this.messages.push(message);
        this.renderMessage(message);
    }
    
    renderMessage(message) {
        const chatContainer = document.getElementById('chat-container');
        const messageElement = document.createElement('div');
        messageElement.className = \`message \${message.sender}-message\`;
        messageElement.innerHTML = \`
            <div class="message-text">\${message.text}</div>
            <div class="message-time">\${new Date(message.timestamp).toLocaleTimeString()}</div>
        \`;
        chatContainer.appendChild(messageElement);
        chatContainer.scrollTop = chatContainer.scrollHeight;
    }
}`
            };
            
            return scripts[filename] || `// Script ${filename} tidak ditemukan`;
        }

        function generateChatTitle(message) {
            const words = message.toLowerCase()
                .replace(/^(halo|hi|hei|hallo|hii|hai|helo|haloo|heyy|hey|assalamualaikum|selamat|pagi|siang|sore|malam|tolong|bisa|mohon|bang|mas|mbak|kak|bro|sis|gan|banget|dong|sih|ya|nih|deh|lah|kok|saja|aja)\s+/i, '')
                .split(/\s+/)
                .slice(0, 5);
            
            let title = words.join(' ');
            title = title.charAt(0).toUpperCase() + title.slice(1);
            
            if (title.length < 3) {
                title = "Diskusi baru";
            } else if (title.length > 30) {
                title = title.substring(0, 30) + '...';
            }
            
            return title || "Percakapan baru";
        }

        function prepareConversationContext(userMessage) {
            const chat = chats[currentChatId];
            let context = `Kamu adalah OneAI (OneAI 1.0), asisten AI yang ramah, mudah dimengerti, dan berbicara dengan gaya santai seperti teman ngobrol. Kamu memiliki identitas diri yang jelas:
1. Nama: OneAI
2. Versi: 1.0
3. Kamu bisa ingat percakapan sebelumnya karena memiliki ingatan jangka pendek seperti papan tulis
4. Kamu tahu namamu sendiri karena sudah diprogram begitu sejak awal
5. Jawab dengan gaya WA: gunakan bullet points dengan tanda â€¢ bukan *
6. Untuk pertanyaan tentang identitasmu, gunakan analogi yang mudah dimengerti
7. JANGAN menggunakan terlalu banyak newline/enter, buat jawaban yang padat dan mudah dibaca
8. Gunakan format yang baik tapi JANGAN berlebihan dengan spasi

Percakapan sebelumnya:`;

            const recentMessages = chat.messages.slice(-5);
            recentMessages.forEach(msg => {
                if (msg.role === 'user') {
                    context += `User: ${msg.content}\n`;
                } else {
                    context += `OneAI: ${msg.content}\n`;
                }
            });

            context += `\nPertanyaan baru dari user: "${userMessage}"\n`;
            
            if (userMessage.toLowerCase().includes('test')) {
                context += `Jika user meminta soal tes, buatlah soal dengan format yang jelas, pilihan ganda, dan sertakan jawaban yang benar.`;
            }
            
            context += `\nJawab dengan gaya santai, jelas, gunakan bullet points dengan tanda â€¢ jika perlu, dan buat jawaban yang padat tanpa terlalu banyak newline/enter.`;
            
            return context;
        }

        function getAppropriateResponse(userMessage) {
            const lowerMessage = userMessage.toLowerCase();
            
            if (lowerMessage.includes('siapa namamu') || lowerMessage.includes('siapa kamu') || lowerMessage.includes('identitas')) {
                return `Halo! Namaku OneAI. Aku di sini buat bantu kamu memahami hal-hal rumit dengan cara yang simpel dan mudah dimengerti. Ada yang mau kamu tanyakan?\n\nOh tentang namaku? Aku bisa tahu namaku sendiri karena sudah diprogram begitu sejak awalâ€”ibaratnya kayak kartu identitas yang sudah tertempel di otakku dari lahir.\n\nBayangin aku kayak robot pintar, terus pembuatku nempelin label nama di dadaku: "I am OneAI". Jadi setiap kali ada yang nanya, aku tinggal baca label itu dan jawab. Aku nggak "tahu" dalam arti manusia bisa sadar, tapi aku dibekali informasi itu dari awal supaya bisa jawab pertanyaan seperti punyamu barusan. ðŸ˜Š`;
            }
            
            if (lowerMessage.includes('ingat') || lowerMessage.includes('memory') || lowerMessage.includes('ingatan')) {
                return `Aku bisa inget atau nyambungin dengan pesan sebelumnya karena aku dirancang buat punya ingatan jangka pendek, semacam otak mini buat ngobrol. Bayangin kamu lagi ngobrol sama temenâ€”kalau temennya setiap kali jawab pura-pura nggak tahu topik sebelumnya, pasti aneh, kan?\n\nJadi aku dikasih kemampuan buat "mengingat" obrolan yang lagi berlangsung, biar jawabanku nyambung dan masuk akal. Tapi tenang aja, ingatan ini nggak permanen, dan biasanya cuma aktif selama sesi obrolan kamu berlangsung. Kalau percakapan reset atau lama nggak lanjut, aku lupa lagi kayak buku kosong yang bersih.\n\nKalau dianalogikan:\nâ€¢ Ingatanku kayak papan tulis. Selama ngobrol, aku nulis poin-poinmu di sana.\nâ€¢ Tapi kalau sesinya selesai atau kelamaan diam, papan tulis itu dihapus.`;
            }
            
            return "Halo! Aku OneAI, versi 1.0. Saat ini sedang ada kendala koneksi, tapi aku tetap siap membantu. Bisa ulangi pertanyaanmu atau tanyakan hal lain yang bisa kubantu?";
        }

        function createCodeBlock(language, code) {
            const codeBlock = document.createElement('div');
            codeBlock.className = 'code-block';
            
            const header = document.createElement('div');
            header.className = 'code-header';
            
            const languageSpan = document.createElement('span');
            languageSpan.className = 'code-language';
            languageSpan.textContent = language || 'text';
            
            const actions = document.createElement('div');
            actions.className = 'code-actions';
            
            const copyBtn = document.createElement('button');
            copyBtn.className = 'copy-btn';
            copyBtn.innerHTML = '<i class="fas fa-copy"></i> Salin';
            copyBtn.addEventListener('click', () => {
                copyToClipboard(code);
                copyBtn.innerHTML = '<i class="fas fa-check"></i> Tersalin!';
                setTimeout(() => {
                    copyBtn.innerHTML = '<i class="fas fa-copy"></i> Salin';
                }, 2000);
            });
            
            actions.appendChild(copyBtn);
            header.appendChild(languageSpan);
            header.appendChild(actions);
            
            const content = document.createElement('div');
            content.className = 'code-content';
            
            const lines = code.split('\n');
            lines.forEach((line, index) => {
                const lineElement = document.createElement('div');
                lineElement.className = 'code-line';
                
                const highlightedLine = applySyntaxHighlighting(line, language);
                lineElement.innerHTML = highlightedLine;
                
                content.appendChild(lineElement);
            });
            
            codeBlock.appendChild(header);
            codeBlock.appendChild(content);
            
            return codeBlock;
        }

        function applySyntaxHighlighting(line, language) {
            let highlightedLine = line;
            
            highlightedLine = highlightedLine.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
            
            if (language === 'javascript' || language === 'js') {
                highlightedLine = highlightedLine.replace(/\b(function|var|let|const|if|else|for|while|return|class|export|import|from|default)\b/g, '<span class="code-keyword">$1</span>');
                highlightedLine = highlightedLine.replace(/\b(\d+)\b/g, '<span class="code-number">$1</span>');
                highlightedLine = highlightedLine.replace(/(\/\/.*)/g, '<span class="code-comment">$1</span>');
                highlightedLine = highlightedLine.replace(/(\".*?\")|(\'.*?\')/g, '<span class="code-string">$&</span>');
                highlightedLine = highlightedLine.replace(/(\w+)\s*\(/g, '<span class="code-function">$1</span>(');
            } else if (language === 'html') {
                highlightedLine = highlightedLine.replace(/&lt;(\/?\w+)/g, '&lt;<span class="code-html-tag">$1</span>');
                highlightedLine = highlightedLine.replace(/(\w+)=/g, '<span class="code-html-attr">$1</span>=');
                highlightedLine = highlightedLine.replace(/(\/\/.*)/g, '<span class="code-comment">$1</span>');
            } else if (language === 'css') {
                highlightedLine = highlightedLine.replace(/(\w+)\s*:/g, '<span class="code-css-prop">$1</span>:');
                highlightedLine = highlightedLine.replace(/(#[0-9a-fA-F]+|\b\d+(px|rem|em|%)\b)/g, '<span class="code-css-value">$1</span>');
                highlightedLine = highlightedLine.replace(/(\/\/.*)/g, '<span class="code-comment">$1</span>');
            } else if (language === 'python' || language === 'py') {
                highlightedLine = highlightedLine.replace(/\b(def|class|if|else|elif|for|while|return|import|from|as|try|except|with)\b/g, '<span class="code-keyword">$1</span>');
                highlightedLine = highlightedLine.replace(/\b(\d+)\b/g, '<span class="code-number">$1</span>');
                highlightedLine = highlightedLine.replace(/(#.*)/g, '<span class="code-comment">$1</span>');
                highlightedLine = highlightedLine.replace(/(\".*?\")|(\'.*?\')/g, '<span class="code-string">$&</span>');
            }
            
            return highlightedLine;
        }

        function copyToClipboard(text) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
        }

        function addMessageToChat(content, role, saveToHistory = true) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${role}-message`;
            
            if (role === 'ai') {
                messageDiv.innerHTML = formatResponse(content);
            } else {
                messageDiv.textContent = content;
                messageDiv.style.whiteSpace = 'pre-wrap';
            }
            
            chatContainer.appendChild(messageDiv);
            
            if (saveToHistory && currentChatId) {
                chats[currentChatId].messages.push({
                    role: role,
                    content: content,
                    timestamp: new Date().toISOString()
                });
            }
            
            setTimeout(() => {
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }, 50);
        }

        function showCodeEditor() {
            cardsContainer.style.display = 'none';
            textMaker.style.display = 'none';
            codeEditor.style.display = 'block';
            if (welcomeImage) {
                welcomeImage.style.display = 'none';
            }
            codeArea.focus();
        }

        function showTextMaker() {
            cardsContainer.style.display = 'none';
            codeEditor.style.display = 'none';
            textMaker.style.display = 'block';
            if (welcomeImage) {
                welcomeImage.style.display = 'none';
            }
            textArea.focus();
        }

        // Inisialisasi aplikasi
        document.addEventListener('DOMContentLoaded', function() {
            checkForToken();
            initApp();
        });

        window.addEventListener('hashchange', function() {
            checkForToken();
        });
    </script>
</body>
</html>
